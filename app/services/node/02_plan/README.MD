
## ğŸ§  Node: `plan_retrieval_node.py`

ì´ ë…¸ë“œëŠ” **LangGraph + LangChain Tool Calling**ì„ í™œìš©í•˜ì—¬, ì‚¬ìš©ìì˜ ì§ˆë¬¸ì„ ë¶„ì„í•˜ê³  ìµœì ì˜ ë¬¸ì„œ ê²€ìƒ‰ ì „ëµì„ ìë™ìœ¼ë¡œ ìƒì„±í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.

---

### ğŸ”§ ê¸°ëŠ¥ ìš”ì•½

* ì‚¬ìš©ì ì§ˆë¬¸ì„ ê¸°ë°˜ìœ¼ë¡œ **ê²€ìƒ‰ ì „ëµ (`strategy`)** ê²°ì •
* í•„ìš”í•œ **ë¬¸ì„œ ìœ í˜• (`data_type`)** ë¶„ë¥˜ (ê¸°ì‚¬, ë…¼í‰ ë“±)
* **ê²€ìƒ‰ìš© ì§ˆë¬¸ ì¬ì‘ì„± (`rewritten_question`)**
* **ë‚ ì§œ/ì •ë‹¹ í•„í„° (`filters`)** ì¶”ì¶œ
* **ìš”ì•½/ì„¤ëª… ìƒì„± í•„ìš” ì—¬ë¶€ (`generation_required`)** íŒë‹¨
* **ë³¸ë¬¸ ìˆ˜ì • í•„ìš” ì—¬ë¶€ (`apply_body_required`)** íŒë‹¨

LangChainì˜ `Pydantic tool calling` ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬, GPTê°€ ìœ„ ì •ë³´ë¥¼ êµ¬ì¡°í™”ëœ JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ë„ë¡ ìœ ë„í•©ë‹ˆë‹¤.

---

### ğŸ§© ê¸°ìˆ  ìŠ¤íƒ

* `LangGraph`: ìƒíƒœ ê¸°ë°˜ LLM ê·¸ë˜í”„ íë¦„
* `LangChain`: LLM + Tool í˜¸ì¶œ ì²´ì¸ êµ¬ì„±
* `ChatOpenAI`: GPT-4o ëª¨ë¸ ì‚¬ìš©
* `Pydantic`: ì‘ë‹µ êµ¬ì¡° ì •ì˜
* `Tool Calling`: GPTê°€ ì§ì ‘ `RetrievalPlan` toolì„ í˜¸ì¶œí•˜ì—¬ ì‘ë‹µ ìƒì„±

---

### ğŸ“¥ ì…ë ¥ ìƒíƒœ (`GraphState`)

```json
{
  "question": "ê° ë‹¹ì˜ ì´ì„  ê³µì•½ì„ ë¹„êµí•´ì¤˜",
  "selected_text": "ì´ì„  ê³µì•½",
  "use_full_document": false
}
```

---

### ğŸ“¤ ì¶œë ¥ ìƒíƒœ (`GraphState + plan`)

```json
{
  "plan": {
    "strategy": "balanced_retrieval",
    "data_type": ["opinion", "editorial"],
    "rewritten_question": "ì´ì„  ê³µì•½ ë¹„êµ",
    "filters": {
      "startdate": "2024-07-25",
      "enddate": "2025-07-25",
      "party": ["ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹", "êµ­ë¯¼ì˜í˜"]
    },
    "parameters": {
      "k": 10,
      "k_per_side": 5
    },
    "generation_required": true,
    "apply_body_required": false
  }
}
```

---

### ğŸ“Œ ì „ëµ ì¢…ë¥˜ (`strategy` í•„ë“œ)

| ê°’                    | ì„¤ëª…                    |
| -------------------- | --------------------- |
| `standard_retrieval` | ì¼ë°˜ ì •ë³´ íƒìƒ‰ ëª©ì            |
| `balanced_retrieval` | ì •ë‹¹ ë¹„êµ ë“± ê· í˜• ì¡íŒ ê´€ì  í•„ìš” ì‹œ |
| `title_generation`   | ì½˜í…ì¸  ê¸°ë°˜ ì œëª© ìƒì„± ìš”ì²­       |
| `no_retrieval`       | ê²€ìƒ‰ ì—†ì´ ë°”ë¡œ ë‹µë³€ ê°€ëŠ¥í•œ ê²½ìš°    |
| `no_generate`        | ë¶€ì ì ˆí•œ ì§ˆë¬¸ ë“± ì²˜ë¦¬ ê±°ë¶€ í•„ìš” ì‹œ  |

---

### âœ… ì‚¬ìš© ì˜ˆì‹œ

```python
from nodes.plan_retrieval_node import plan_retrieval_node

updated_state = plan_retrieval_node({
  "question": "í›„ë³´ë³„ ê³µì•½ ì°¨ì´ë¥¼ ì•Œë ¤ì¤˜",
  "selected_text": "ê³µì•½",
  "use_full_document": False
})
print(updated_state["plan"])
```

